beta_list[["b"]][s - burn, ] <- beta0[["b"]]
beta_list[["c"]][s - burn, ] <- beta0[["c"]]
}
}
}
par(mfrow = c(3, 2))
for(j in sample(ncol(beta_list$b), 6)){
plot(beta_list$b[, j], type = 'l', ylab = paste("Beta", j), xlab = "Iter", col = "purple",
main = paste("Acceptance ratio =", round(length(unique(beta_list$b[,j])) / nrow(beta_list$b), 3)))
acf(beta_list$b[, j], ylab = paste("Beta", j), main = paste("Series Beta", j))
}
proposal_sd <- 0.025
#
proposal_lpdf <- function(beta, beta0){
K <- length(beta)
lpdf <- 0
for(k in 2:K){
lpdf <- lpdf + sum(dnorm(beta[[k]], mean = beta0[[k]], sd = proposal_sd, log = T))
}
return(lpdf)
}
#
prior_lpdf <- function(beta){
K <- length(beta)
lpdf <- 0
for(k in 2:K){
lpdf <- lpdf + sum(dnorm(beta[[k]], sd = 0.5, log = T))
}
return(lpdf)
}
#
likelihood_lpdf <- function(y, X, beta){
K <- length(beta)
lpdf <- 0
for(k in 1:K){
lpdf <- lpdf + sum(sapply(which(y == k), function(i){
sum(X[i, ]*beta[[k]]) - log(sum(sapply(1:K, function(b){
exp(sum(X[i, ]*beta[[b]]))
})))
})
)
}
return(lpdf)
}
S <- 10000
burn <- 5000
beta0 <- list(a = 0, b = rnorm(ncol(X)), c = rnorm(ncol(X)))
beta_list <- list(a = rep(0, S - burn),
b = matrix(NA, nrow = S - burn, ncol = ncol(X)),
c = matrix(NA, nrow = S - burn, ncol = ncol(X)))
for(s in 1:S){
#
beta_star <- list(a = 0,
b = rnorm(length(beta0[[2]]), mean = beta0[[2]], sd = proposal_sd),
c = rnorm(length(beta0[[3]]), mean = beta0[[3]], sd = proposal_sd))
#
r <- exp((likelihood_lpdf(y, X, beta_star) + prior_lpdf(beta_star) + proposal_lpdf(beta0, beta_star)) -
(likelihood_lpdf(y, X, beta0) + prior_lpdf(beta0) + proposal_lpdf(beta_star, beta0)))
#
if(runif(1) < r){
if(s > burn){
beta_list[["a"]][s - burn] <- beta_star[["a"]]
beta_list[["b"]][s - burn, ] <- beta_star[["b"]]
beta_list[["c"]][s - burn, ] <- beta_star[["c"]]
}
beta0 <- beta_star
} else {
if(s > burn){
beta_list[["a"]][s - burn] <- beta0[["a"]]
beta_list[["b"]][s - burn, ] <- beta0[["b"]]
beta_list[["c"]][s - burn, ] <- beta0[["c"]]
}
}
}
par(mfrow = c(3, 2))
for(j in sample(ncol(beta_list$b), 6)){
plot(beta_list$b[, j], type = 'l', ylab = paste("Beta", j), xlab = "Iter", col = "purple",
main = paste("Acceptance ratio =", round(length(unique(beta_list$b[,j])) / nrow(beta_list$b), 3)))
acf(beta_list$b[, j], ylab = paste("Beta", j), main = paste("Series Beta", j))
}
proposal_sd <- 0.035
#
proposal_lpdf <- function(beta, beta0){
K <- length(beta)
lpdf <- 0
for(k in 2:K){
lpdf <- lpdf + sum(dnorm(beta[[k]], mean = beta0[[k]], sd = proposal_sd, log = T))
}
return(lpdf)
}
#
prior_lpdf <- function(beta){
K <- length(beta)
lpdf <- 0
for(k in 2:K){
lpdf <- lpdf + sum(dnorm(beta[[k]], sd = 0.5, log = T))
}
return(lpdf)
}
#
likelihood_lpdf <- function(y, X, beta){
K <- length(beta)
lpdf <- 0
for(k in 1:K){
lpdf <- lpdf + sum(sapply(which(y == k), function(i){
sum(X[i, ]*beta[[k]]) - log(sum(sapply(1:K, function(b){
exp(sum(X[i, ]*beta[[b]]))
})))
})
)
}
return(lpdf)
}
S <- 10000
burn <- 5000
beta0 <- list(a = 0, b = rnorm(ncol(X)), c = rnorm(ncol(X)))
beta_list <- list(a = rep(0, S - burn),
b = matrix(NA, nrow = S - burn, ncol = ncol(X)),
c = matrix(NA, nrow = S - burn, ncol = ncol(X)))
for(s in 1:S){
#
beta_star <- list(a = 0,
b = rnorm(length(beta0[[2]]), mean = beta0[[2]], sd = proposal_sd),
c = rnorm(length(beta0[[3]]), mean = beta0[[3]], sd = proposal_sd))
#
r <- exp((likelihood_lpdf(y, X, beta_star) + prior_lpdf(beta_star) + proposal_lpdf(beta0, beta_star)) -
(likelihood_lpdf(y, X, beta0) + prior_lpdf(beta0) + proposal_lpdf(beta_star, beta0)))
#
if(runif(1) < r){
if(s > burn){
beta_list[["a"]][s - burn] <- beta_star[["a"]]
beta_list[["b"]][s - burn, ] <- beta_star[["b"]]
beta_list[["c"]][s - burn, ] <- beta_star[["c"]]
}
beta0 <- beta_star
} else {
if(s > burn){
beta_list[["a"]][s - burn] <- beta0[["a"]]
beta_list[["b"]][s - burn, ] <- beta0[["b"]]
beta_list[["c"]][s - burn, ] <- beta0[["c"]]
}
}
}
par(mfrow = c(3, 2))
for(j in sample(ncol(beta_list$b), 6)){
plot(beta_list$b[, j], type = 'l', ylab = paste("Beta", j), xlab = "Iter", col = "purple",
main = paste("Acceptance ratio =", round(length(unique(beta_list$b[,j])) / nrow(beta_list$b), 3)))
acf(beta_list$b[, j], ylab = paste("Beta", j), main = paste("Series Beta", j))
}
proposal_sd <- 0.03
#
proposal_lpdf <- function(beta, beta0){
K <- length(beta)
lpdf <- 0
for(k in 2:K){
lpdf <- lpdf + sum(dnorm(beta[[k]], mean = beta0[[k]], sd = proposal_sd, log = T))
}
return(lpdf)
}
#
prior_lpdf <- function(beta){
K <- length(beta)
lpdf <- 0
for(k in 2:K){
lpdf <- lpdf + sum(dnorm(beta[[k]], sd = 0.5, log = T))
}
return(lpdf)
}
#
likelihood_lpdf <- function(y, X, beta){
K <- length(beta)
lpdf <- 0
for(k in 1:K){
lpdf <- lpdf + sum(sapply(which(y == k), function(i){
sum(X[i, ]*beta[[k]]) - log(sum(sapply(1:K, function(b){
exp(sum(X[i, ]*beta[[b]]))
})))
})
)
}
return(lpdf)
}
S <- 10000
burn <- 5000
beta0 <- list(a = 0, b = rnorm(ncol(X)), c = rnorm(ncol(X)))
beta_list <- list(a = rep(0, S - burn),
b = matrix(NA, nrow = S - burn, ncol = ncol(X)),
c = matrix(NA, nrow = S - burn, ncol = ncol(X)))
for(s in 1:S){
#
beta_star <- list(a = 0,
b = rnorm(length(beta0[[2]]), mean = beta0[[2]], sd = proposal_sd),
c = rnorm(length(beta0[[3]]), mean = beta0[[3]], sd = proposal_sd))
#
r <- exp((likelihood_lpdf(y, X, beta_star) + prior_lpdf(beta_star) + proposal_lpdf(beta0, beta_star)) -
(likelihood_lpdf(y, X, beta0) + prior_lpdf(beta0) + proposal_lpdf(beta_star, beta0)))
#
if(runif(1) < r){
if(s > burn){
beta_list[["a"]][s - burn] <- beta_star[["a"]]
beta_list[["b"]][s - burn, ] <- beta_star[["b"]]
beta_list[["c"]][s - burn, ] <- beta_star[["c"]]
}
beta0 <- beta_star
} else {
if(s > burn){
beta_list[["a"]][s - burn] <- beta0[["a"]]
beta_list[["b"]][s - burn, ] <- beta0[["b"]]
beta_list[["c"]][s - burn, ] <- beta0[["c"]]
}
}
}
par(mfrow = c(3, 2))
for(j in sample(ncol(beta_list$b), 6)){
plot(beta_list$b[, j], type = 'l', ylab = paste("Beta", j), xlab = "Iter", col = "purple",
main = paste("Acceptance ratio =", round(length(unique(beta_list$b[,j])) / nrow(beta_list$b), 3)))
acf(beta_list$b[, j], ylab = paste("Beta", j), main = paste("Series Beta", j))
}
proposal_sd <- 0.05
#
proposal_lpdf <- function(beta, beta0){
K <- length(beta)
lpdf <- 0
for(k in 2:K){
lpdf <- lpdf + sum(dnorm(beta[[k]], mean = beta0[[k]], sd = proposal_sd, log = T))
}
return(lpdf)
}
#
prior_lpdf <- function(beta){
K <- length(beta)
lpdf <- 0
for(k in 2:K){
lpdf <- lpdf + sum(dnorm(beta[[k]], sd = 0.5, log = T))
}
return(lpdf)
}
#
likelihood_lpdf <- function(y, X, beta){
K <- length(beta)
lpdf <- 0
for(k in 1:K){
lpdf <- lpdf + sum(sapply(which(y == k), function(i){
sum(X[i, ]*beta[[k]]) - log(sum(sapply(1:K, function(b){
exp(sum(X[i, ]*beta[[b]]))
})))
})
)
}
return(lpdf)
}
S <- 10000
burn <- 5000
beta0 <- list(a = 0, b = rnorm(ncol(X)), c = rnorm(ncol(X)))
beta_list <- list(a = rep(0, S - burn),
b = matrix(NA, nrow = S - burn, ncol = ncol(X)),
c = matrix(NA, nrow = S - burn, ncol = ncol(X)))
for(s in 1:S){
#
beta_star <- list(a = 0,
b = rnorm(length(beta0[[2]]), mean = beta0[[2]], sd = proposal_sd),
c = rnorm(length(beta0[[3]]), mean = beta0[[3]], sd = proposal_sd))
#
r <- exp((likelihood_lpdf(y, X, beta_star) + prior_lpdf(beta_star) + proposal_lpdf(beta0, beta_star)) -
(likelihood_lpdf(y, X, beta0) + prior_lpdf(beta0) + proposal_lpdf(beta_star, beta0)))
#
if(runif(1) < r){
if(s > burn){
beta_list[["a"]][s - burn] <- beta_star[["a"]]
beta_list[["b"]][s - burn, ] <- beta_star[["b"]]
beta_list[["c"]][s - burn, ] <- beta_star[["c"]]
}
beta0 <- beta_star
} else {
if(s > burn){
beta_list[["a"]][s - burn] <- beta0[["a"]]
beta_list[["b"]][s - burn, ] <- beta0[["b"]]
beta_list[["c"]][s - burn, ] <- beta0[["c"]]
}
}
}
thin_seq <- seq(1, nrow(beta_list$b), by = 10)
par(mfrow = c(3, 2))
for(j in sample(ncol(beta_list$b), 6)){
plot(beta_list$b[thin_seq, j], type = 'l', ylab = paste("Beta", j), xlab = "Iter", col = "purple",
main = paste("Acceptance ratio =", round(length(unique(beta_list$b[thin_seq,j])) / nrow(beta_list$b[thin_seq, ]), 3)))
acf(beta_list$b[thin_seq, j], ylab = paste("Beta", j), main = paste("Series Beta", j))
}
thin_seq <- seq(1, nrow(beta_list$b), by = 10)
par(mfrow = c(3, 2))
for(j in sample(ncol(beta_list$b), 6)){
plot(beta_list$b[thin_seq, j], type = 'l', ylab = paste("Beta", j), xlab = "Iter", col = "purple",
main = paste("Acceptance ratio =", round(length(unique(beta_list$b[thin_seq,j])) / nrow(beta_list$b[thin_seq, ]), 3)))
acf(beta_list$b[thin_seq, j], ylab = paste("Beta", j), main = paste("Series Beta", j))
}
((-beta_list$b[thin_seq, ] - beta_list$c[thin_seq, ])/2) %>%
reshape2::melt() %>%
dplyr::mutate(cat = "1") %>%
rbind(reshape2::melt(beta_list$b[thin_seq, ] + ((-beta_list$b[thin_seq, ] - beta_list$c[thin_seq, ])/2)) %>% dplyr::mutate(cat = "2")) %>%
rbind(reshape2::melt(beta_list$c[thin_seq, ] + ((-beta_list$b[thin_seq, ] - beta_list$c[thin_seq, ])/2)) %>% dplyr::mutate(cat = "3")) %>%
ggplot2::ggplot() +
geom_boxplot(aes(x = as.factor(Var2), y = value, fill = cat))  +
scale_fill_brewer(palette = "Set1", name = "Species", labels = c("Setosa", "Versicolor", "Virginica")) +
labs(x = "Coefficient", y = expression(beta))
denom <- (1 + exp(X%*%t(beta_list$b[thin_seq, ])) + exp(X%*%t(beta_list$c[thin_seq, ])))
mod_preds <- data.frame(setosa = rowMeans(1 / denom),
versicolor = rowMeans(exp(X%*%t(beta_list$b[thin_seq, ])) / denom),
virginica = rowMeans(exp(X%*%t(beta_list$c[thin_seq, ])) / denom))
predicted_species <- apply(mod_preds,1,function(x) unique(modified_iris$Species)[which(x==max(x))])
Conf_mat <- confusionMatrix(predicted_species,modified_iris$Species)
Conf_mat$table
data.frame(sigma = rep(c(1, 2, 4), each = 1000)) %>%
dplyr::group_by(sigma) %>%
dplyr::mutate(x = seq(-10, 10, length.out = 1000),
dens = (1/(2*sigma))*exp(-abs(seq(-10, 10, length.out = 1000))/sigma)) %>%
dplyr::ungroup() %>%
ggplot2::ggplot() +
geom_line(aes(x = x, y = dens, colour = as.factor(sigma), group = as.factor(sigma))) +
scale_colour_manual(values = c("#74a9cf", "#0570b0", "#023858"), name = expression(sigma))
((-beta_list$b[thin_seq, ] - beta_list$c[thin_seq, ])/2) %>%
reshape2::melt() %>%
dplyr::mutate(cat = "1") %>%
rbind(reshape2::melt(beta_list$b[thin_seq, ] + ((-beta_list$b[thin_seq, ] - beta_list$c[thin_seq, ])/2)) %>% dplyr::mutate(cat = "2")) %>%
rbind(reshape2::melt(beta_list$c[thin_seq, ] + ((-beta_list$b[thin_seq, ] - beta_list$c[thin_seq, ])/2)) %>% dplyr::mutate(cat = "3")) %>%
ggplot2::ggplot() +
geom_boxplot(aes(x = as.factor(Var2), y = value, fill = cat))  +
scale_fill_brewer(palette = "Set1", name = "Species", labels = c("Setosa", "Versicolor", "Virginica")) +
labs(x = "Coefficient", y = expression(beta))
denom <- (1 + exp(X%*%t(beta_list$b[thin_seq, ])) + exp(X%*%t(beta_list$c[thin_seq, ])))
mod_preds <- data.frame(setosa = rowMeans(1 / denom),
versicolor = rowMeans(exp(X%*%t(beta_list$b[thin_seq, ])) / denom),
virginica = rowMeans(exp(X%*%t(beta_list$c[thin_seq, ])) / denom))
predicted_species <- apply(mod_preds,1,function(x) unique(modified_iris$Species)[which(x==max(x))])
Conf_mat <- confusionMatrix(predicted_species,modified_iris$Species)
Conf_mat$table
Conf_mat$overall["Accuracy"];
Conf_mat$overall["Accuracy"];
denom <- (1 + exp(X%*%t(beta_list$b[thin_seq, ])) + exp(X%*%t(beta_list$c[thin_seq, ])))
mod_preds <- data.frame(setosa = rowMeans(1 / denom),
versicolor = rowMeans(exp(X%*%t(beta_list$b[thin_seq, ])) / denom),
virginica = rowMeans(exp(X%*%t(beta_list$c[thin_seq, ])) / denom))
predicted_species <- apply(mod_preds,1,function(x) unique(modified_iris$Species)[which(x==max(x))])
Conf_mat <- confusionMatrix(predicted_species,modified_iris$Species)
Conf_mat$table
Conf_mat$overall["Accuracy"];
accuracy1 <- Conf_mat$overall["Accuracy"]
denom <- (1 + exp(X%*%t(beta_list$b[thin_seq, ])) + exp(X%*%t(beta_list$c[thin_seq, ])))
mod_preds <- data.frame(setosa = rowMeans(1 / denom),
versicolor = rowMeans(exp(X%*%t(beta_list$b[thin_seq, ])) / denom),
virginica = rowMeans(exp(X%*%t(beta_list$c[thin_seq, ])) / denom))
predicted_species <- apply(mod_preds,1,function(x) unique(modified_iris$Species)[which(x==max(x))])
Conf_mat <- confusionMatrix(predicted_species,modified_iris$Species)
Conf_mat$table
Conf_mat$overall["Accuracy"];
round(length(unique(beta_list$b[,j])) / nrow(beta_list$b), 3))
round(length(unique(beta_list$b[,j])) / nrow(beta_list$b), 3)
data.frame(sigma = rep(c(1, 2, 4), each = 1000)) %>%
dplyr::group_by(sigma) %>%
dplyr::mutate(x = seq(-10, 10, length.out = 1000),
dens = (1/(2*sigma))*exp(-abs(seq(-10, 10, length.out = 1000))/sigma)) %>%
dplyr::ungroup() %>%
ggplot2::ggplot() +
geom_line(aes(x = x, y = dens, colour = as.factor(sigma), group = as.factor(sigma))) +
scale_colour_manual(values = c("#74a9cf", "#0570b0", "#023858"), name = expression(sigma))
denom <- (1 + exp(X%*%t(beta_list$b[thin_seq, ])) + exp(X%*%t(beta_list$c[thin_seq, ])))
mod_preds <- data.frame(setosa = rowMeans(1 / denom),
versicolor = rowMeans(exp(X%*%t(beta_list$b[thin_seq, ])) / denom),
virginica = rowMeans(exp(X%*%t(beta_list$c[thin_seq, ])) / denom))
predicted_species <- apply(mod_preds,1,function(x) unique(modified_iris$Species)[which(x==max(x))])
Conf_mat <- confusionMatrix(predicted_species,modified_iris$Species)
Conf_mat$table
((-beta_list$b[thin_seq, ] - beta_list$c[thin_seq, ])/2) %>%
reshape2::melt() %>%
dplyr::mutate(cat = "1") %>%
rbind(reshape2::melt(beta_list$b[thin_seq, ] + ((-beta_list$b[thin_seq, ] - beta_list$c[thin_seq, ])/2)) %>% dplyr::mutate(cat = "2")) %>%
rbind(reshape2::melt(beta_list$c[thin_seq, ] + ((-beta_list$b[thin_seq, ] - beta_list$c[thin_seq, ])/2)) %>% dplyr::mutate(cat = "3")) %>%
ggplot2::ggplot() +
geom_boxplot(aes(x = as.factor(Var2), y = value, fill = cat))  +
scale_fill_brewer(palette = "Set1", name = "Species", labels = c("Setosa", "Versicolor", "Virginica")) +
labs(x = "Coefficient", y = expression(beta))
prior_lpdf <- function(beta){
K <- length(beta)
lpdf <- 0
b <- 0.5 / sqrt(2)
for(k in 2:K){
lpdf <- lpdf + sum(-abs(beta[[k]])/b - log(2*b))
}
return(lpdf)
}
((-beta_list$b[thin_seq, ] - beta_list$c[thin_seq, ])/2) %>%
reshape2::melt() %>%
dplyr::mutate(cat = "1") %>%
rbind(reshape2::melt(beta_list$b[thin_seq, ] + ((-beta_list$b[thin_seq, ] - beta_list$c[thin_seq, ])/2)) %>% dplyr::mutate(cat = "2")) %>%
rbind(reshape2::melt(beta_list$c[thin_seq, ] + ((-beta_list$b[thin_seq, ] - beta_list$c[thin_seq, ])/2)) %>% dplyr::mutate(cat = "3")) %>%
ggplot2::ggplot() +
geom_boxplot(aes(x = as.factor(Var2), y = value, fill = cat))  +
scale_fill_brewer(palette = "Set1", name = "Species", labels = c("Setosa", "Versicolor", "Virginica")) +
labs(x = "Coefficient", y = expression(beta))
denom <- (1 + exp(X%*%t(beta_list$b[thin_seq, ])) + exp(X%*%t(beta_list$c[thin_seq, ])))
mod_preds <- data.frame(setosa = rowMeans(1 / denom),
versicolor = rowMeans(exp(X%*%t(beta_list$b[thin_seq, ])) / denom),
virginica = rowMeans(exp(X%*%t(beta_list$c[thin_seq, ])) / denom))
predicted_species <- apply(mod_preds,1,function(x) unique(modified_iris$Species)[which(x==max(x))])
Conf_mat <- confusionMatrix(predicted_species,modified_iris$Species)
Conf_mat$table
Conf_mat$overall["Accuracy"]
Conf_mat$byClass[,c("Sensitivity","Specificity")]
((-beta_list$b[thin_seq, ] - beta_list$c[thin_seq, ])/2) %>%
reshape2::melt() %>%
dplyr::mutate(cat = "1") %>%
rbind(reshape2::melt(beta_list$b[thin_seq, ] + ((-beta_list$b[thin_seq, ] - beta_list$c[thin_seq, ])/2)) %>% dplyr::mutate(cat = "2")) %>%
rbind(reshape2::melt(beta_list$c[thin_seq, ] + ((-beta_list$b[thin_seq, ] - beta_list$c[thin_seq, ])/2)) %>% dplyr::mutate(cat = "3")) %>%
ggplot2::ggplot() +
geom_boxplot(aes(x = as.factor(Var2), y = value, fill = cat))  +
scale_fill_brewer(palette = "Set1", name = "Species", labels = c("Setosa", "Versicolor", "Virginica")) +
labs(x = "Coefficient", y = expression(beta))
((-beta_list$b[thin_seq, ] - beta_list$c[thin_seq, ])/2) %>%
reshape2::melt() %>%
dplyr::mutate(cat = "1") %>%
rbind(reshape2::melt(beta_list$b[thin_seq, ] + ((-beta_list$b[thin_seq, ] - beta_list$c[thin_seq, ])/2)) %>% dplyr::mutate(cat = "2")) %>%
rbind(reshape2::melt(beta_list$c[thin_seq, ] + ((-beta_list$b[thin_seq, ] - beta_list$c[thin_seq, ])/2)) %>% dplyr::mutate(cat = "3")) %>%
ggplot2::ggplot() +
geom_boxplot(aes(x = as.factor(Var2), y = value, fill = cat))  +
scale_fill_brewer(palette = "Set1", name = "Species", labels = c("Setosa", "Versicolor", "Virginica")) +
labs(x = "Coefficient", y = expression(beta))
denom <- (1 + exp(X%*%t(beta_list$b[thin_seq, ])) + exp(X%*%t(beta_list$c[thin_seq, ])))
mod_preds <- data.frame(setosa = rowMeans(1 / denom),
versicolor = rowMeans(exp(X%*%t(beta_list$b[thin_seq, ])) / denom),
virginica = rowMeans(exp(X%*%t(beta_list$c[thin_seq, ])) / denom))
predicted_species <- apply(mod_preds,1,function(x) unique(modified_iris$Species)[which(x==max(x))])
Conf_mat <- confusionMatrix(predicted_species,modified_iris$Species)
Conf_mat$table
Conf_mat$overall["Accuracy"];
accuracy1 <- Conf_mat$overall["Accuracy"]
Conf_mat$overall["Accuracy"];
accuracy1 <- Conf_mat$overall["Accuracy"]
Conf_mat$byClass[,c("Sensitivity","Specificity")]
data.frame(sigma = rep(c(1, 2, 4), each = 1000)) %>%
dplyr::group_by(sigma) %>%
dplyr::mutate(x = seq(-10, 10, length.out = 1000),
dens = (1/(2*sigma))*exp(-abs(seq(-10, 10, length.out = 1000))/sigma)) %>%
dplyr::ungroup() %>%
ggplot2::ggplot() +
geom_line(aes(x = x, y = dens, colour = as.factor(sigma), group = as.factor(sigma))) +
scale_colour_manual(values = c("#74a9cf", "#0570b0", "#023858"), name = expression(sigma))
prior_lpdf <- function(beta){
K <- length(beta)
lpdf <- 0
b <- 0.5 / sqrt(2)
for(k in 2:K){
lpdf <- lpdf + sum(-abs(beta[[k]])/b - log(2*b))
}
return(lpdf)
}
((-beta_list$b[thin_seq, ] - beta_list$c[thin_seq, ])/2) %>%
reshape2::melt() %>%
dplyr::mutate(cat = "1") %>%
rbind(reshape2::melt(beta_list$b[thin_seq, ] + ((-beta_list$b[thin_seq, ] - beta_list$c[thin_seq, ])/2)) %>% dplyr::mutate(cat = "2")) %>%
rbind(reshape2::melt(beta_list$c[thin_seq, ] + ((-beta_list$b[thin_seq, ] - beta_list$c[thin_seq, ])/2)) %>% dplyr::mutate(cat = "3")) %>%
ggplot2::ggplot() +
geom_boxplot(aes(x = as.factor(Var2), y = value, fill = cat))  +
scale_fill_brewer(palette = "Set1", name = "Species", labels = c("Setosa", "Versicolor", "Virginica")) +
labs(x = "Coefficient", y = expression(beta))
proposal_sd <- 0.05
S <- 10000
burn <- 5000
beta0 <- list(a = 0, b = rnorm(ncol(X)), c = rnorm(ncol(X)))
beta_list <- list(a = rep(0, S - burn),
b = matrix(NA, nrow = S - burn, ncol = ncol(X)),
c = matrix(NA, nrow = S - burn, ncol = ncol(X)))
for(s in 1:S){
#
beta_star <- list(a = 0,
b = rnorm(length(beta0[[2]]), mean = beta0[[2]], sd = proposal_sd),
c = rnorm(length(beta0[[3]]), mean = beta0[[3]], sd = proposal_sd))
#
r <- exp((likelihood_lpdf(y, X, beta_star) + prior_lpdf(beta_star) + proposal_lpdf(beta0, beta_star)) -
(likelihood_lpdf(y, X, beta0) + prior_lpdf(beta0) + proposal_lpdf(beta_star, beta0)))
#
if(runif(1) < r){
if(s > burn){
beta_list[["a"]][s - burn] <- beta_star[["a"]]
beta_list[["b"]][s - burn, ] <- beta_star[["b"]]
beta_list[["c"]][s - burn, ] <- beta_star[["c"]]
}
beta0 <- beta_star
} else {
if(s > burn){
beta_list[["a"]][s - burn] <- beta0[["a"]]
beta_list[["b"]][s - burn, ] <- beta0[["b"]]
beta_list[["c"]][s - burn, ] <- beta0[["c"]]
}
}
}
((-beta_list$b[thin_seq, ] - beta_list$c[thin_seq, ])/2) %>%
reshape2::melt() %>%
dplyr::mutate(cat = "1") %>%
rbind(reshape2::melt(beta_list$b[thin_seq, ] + ((-beta_list$b[thin_seq, ] - beta_list$c[thin_seq, ])/2)) %>% dplyr::mutate(cat = "2")) %>%
rbind(reshape2::melt(beta_list$c[thin_seq, ] + ((-beta_list$b[thin_seq, ] - beta_list$c[thin_seq, ])/2)) %>% dplyr::mutate(cat = "3")) %>%
ggplot2::ggplot() +
geom_boxplot(aes(x = as.factor(Var2), y = value, fill = cat))  +
scale_fill_brewer(palette = "Set1", name = "Species", labels = c("Setosa", "Versicolor", "Virginica")) +
labs(x = "Coefficient", y = expression(beta))
denom <- (1 + exp(X%*%t(beta_list$b[thin_seq, ])) + exp(X%*%t(beta_list$c[thin_seq, ])))
mod_preds <- data.frame(setosa = rowMeans(1 / denom),
versicolor = rowMeans(exp(X%*%t(beta_list$b[thin_seq, ])) / denom),
virginica = rowMeans(exp(X%*%t(beta_list$c[thin_seq, ])) / denom))
predicted_species <- apply(mod_preds,1,function(x) unique(modified_iris$Species)[which(x==max(x))])
Conf_mat <- confusionMatrix(predicted_species,modified_iris$Species)
Conf_mat$table
Conf_mat$overall["Accuracy"]
Conf_mat$byClass[,c("Sensitivity","Specificity")]
